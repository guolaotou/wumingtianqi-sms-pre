# Wumingtianqi详细设计设计

## 整体流程
// todo 整体思路流程写在这
// todo er图放在这
// todo 我的思维导图需要有个地方存放；




##  ER图
便于理解中文版


// todo 把英文版的画了？
// 数据库设计按照表写，放到wiki里

## 数据库设计
先用typora写（lucidchart里有中文版er图）

#### 城市表

| 字段名    | 类型        | 说明 | 范例 |
| --------- | ----------- | ---- | ---- |
| id        | int(10)     | PK   | 1    |
| province | varchar(20)     |      | 河北省 |
| city | varchar(20) |    | 石家庄市 |
| district  | varchar(20) |      | 长安区 |
| abbr | varchar(60) | | 河北/石家庄/长安 |
| pinyin | varchar(30) | | changan |
| code     | varchar(30) |      | WWasfasdf          |



#### 天气预报表
xxx


/todo 获取城市天气，存入表咯



/ todo 用户订阅提醒表



/todo 提醒预警静态表


#### 提醒模式表

| id   | 前端配置文案 | 提醒对象 | 气象分类 | value | format_text                      | vip  | tag      | priority_display | priority_remind |
| ---- | ------------ | -------- | -------- | ----- | -------------------------------- | ---- | -------- | ---------------- | --------------- |
| 1    | 突然降雨     | 天气现象 | 天气现象 |       | {text_day}{text_night}，注意带伞 | 0    | 通勤     | 1                | 1               |
| 2    | 突然升温     | 最高温度 | 温度     | 5     |                                  | 0    | 通勤     | 2                | 1               |
| 3    | 突然降温     | 最高温度 | 温度     | 5     |                                  | 0    | 通勤     | 3                | 1               |
| 4    | 空气质量变差 |          |          |       |                                  | 1    | 通勤     | 4                | 1               |
| 5    | 9点突然升温  | 9点温度  | 温度     | 5     |                                  | 2    | 通勤     | 5                | 1               |
|      | 更多配置 --- |          |          |       |                                  |      |          |                  |                 |
| 6    | 高温预警     | 最高温度 | 温度     | 40    |                                  | 1    | 更多配置 | 1                | 2               |
| 7    | 低温预警     | 最低温度 | 温度     | -10   |                                  | 1    | 更多配置 | 2                | 2               |
|      |              |          |          |       |                                  |      |          |                  |                 |
|      |              |          |          |       |                                  |      |          |                  |                 |


todo: ”单位“绑定到气象分类上

todo: 提醒模式一一对应到历史天气表，用实例说明？

pattern1:突然降雨

- 天气表code_day ![1,2,3] -> [1,2,3]
- 天气表code_night ![1,2,3] -> [1,2,3]
- 以上条件取”或“？

这里是需要思考的地方。

另外：format_text是不是可以先硬编码进代码

另外：遇到重复的提醒，应该怎么安排优先级，例如”降温5度“和”低温预警“同时生效

// todo
1.先不做优先级
2.先不做重复的情况（后面看下怎么弄）

3.做：switch case,把每一个情况硬编码进来，然后造天气数据，造测试用例，覆盖这几种模式
3.1 数据库表：提醒模式表、订单表建立
pattern2：


















